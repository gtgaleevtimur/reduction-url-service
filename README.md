# Сервис сокращения URL
## Описание проекта

Сервис представляет собой работу по сокращению URL-адресов. Взаимодействие с сервисом происходит по REST API и
опционально gRPC. В сервисе реализовано хранение данных по умолчанию в оперативной памяти,
опционально в БД(PostgresSQL) и записью в текстовый файл, как в резервное хранилище.
Опционально сервис поддерживает запуск сервера по протоку HTTPS.
Аутентификация пользователя происходит через cookie в REST, через метаданные в gRPC.
При запуске сервиса необходимо задать все требующиеся опции через конфигурационный файл.

### Детали конфигурации.
Конфигурационный файл инициализируется и зависит от переданных флагов при запуске,или от переменных окружения
, или от конфигурационного файла json путь которого передается через переменную окружения `CONFIG`.

Внимание! Переданные значения флагов имеют приоритет над переменными окружения,а переменные окружения над значениями json.

По умолчанию сервис инициализирует хранилище в оперативной памяти и запускается по адресу 
"localhost:8080".

Для запуска сервера на определенном адресе необходимо при запуске передать значение флага `-a` или
задать значение переменной окружения `SERVER_ADDRESS`,или в json поле `"server_address"`.

Для установки базового значения URL сервиса сокращения необходимо при запуске передать значение флага `-b` или
задать значение переменной окружения `BASE_URL`,или в json поле `"base_url"`.

Для установки использования резервного хранилища в виде текстового файла необходимо при запуске передать путь файла через
значение флага `-f` или
задать значение переменной окружения `FILE_STORAGE_PATH`,или в json поле `"file_storage_path"`.

Для установки использования БД Postgres необходимо при запуске передать путь БД с настройками допуска через
значение флага `-d` или
задать значение переменной окружения `DATABASE_DSN`,или в json поле `"database_dsn"`.

Для установки использования сервиса на протоке HTTPS
значение флага `-s` или
задать значение переменной окружения `ENABLE_HTTPS`,или в json поле `"enable_https"`.

Для установки использования сервиса на протоке HTTPS
значение флага `-s` или
задать значение переменной окружения `ENABLE_HTTPS`,или в json поле `"enable_https"`.

Для установки использования сервиса c предустановленным доменом доверительной сети необходимо передать домен через
значение флага `-t` или
задать значение переменной окружения `TRUSTED_SUBNET`,или в json поле `"trusted_subnet"`.

Для установки использования сервиса так же с использованием GRPC необходимо передать `true` через значение флага `-g` или
задать значение переменной окружения `ENABLE_GRPC`,или в json поле `"enable_grpc"`.Внимание! gRPC запускается на любом доступном локальном адресе,адресс запуска выводится в консоль.

Для установки использования сервиса c настройками json необходимо передать путь файла через
значение флага `-с` или
задать значение переменной окружения `CONFIG`.

## REST API

Эндпоинт POST `/` принимает в теле запроса в виде текста строку URL для сокращения и
возвращает ответ с кодом `201` и сокращённым URL в виде текстовой строки в теле пакета

Эндпоинт GET `/{hash}` принимает в качестве параметра идентификатор сокращённого URL и
возвращает ответ с статусом `307` и оригинальным URL в HTTP-заголовке `Location`


Эндпоинт GET `/ping` проверяет доступность базы данных, выдает ответ с статусом `200`,
если доступна, и `500` - если не доступна

Эндпоинт GET `/api/internal/stats` проверяет, если установлено, сеть на заслуживающую доверия и возвращает статистику
по количеству сокращенных URL и количеству пользователей в сервисе
в формате массива JSON-структур `{"urls":"<urls_count>","users":"<users_count>"}`

Эндпоинт DELETE `/api/user/urls`, принимает задания на удаление списка ранее сформированных URL,
выдаёт ответ со статусом `202`, после чего в асинхронном режиме удаляет записи из базы

Эндпоинт GET `/api/user/urls` считывает `UserID` из `cookie` запроса и выдаёт все URL, сохраненные этим пользователем
в формате массива JSON-структур `{"short_url":"<some_shorten_url>","original_url":"<some_original_url>"}`

Эндпоинт POST `/api/shorten` - аналогичен предыдущему, но принимает в теле запроса JSON-объект `{"url":"<original_url>"}`
и возвращает в теле ответа JSON-объект `{"result":"<shorten_url>"}`

Эндпоинт POST `/api/shorten/batch`, принимает в теле запроса множество URL для сокращения
в формате массива JSON-структур `{"correlation_id":"<some_id>","original_url":"<some_original_url>"}` и
возвращает сокращенные URL в формате массива JSON-структур `{"correlation_id":"<some_id>","short_url":"<some_shorten_url>"}}`

